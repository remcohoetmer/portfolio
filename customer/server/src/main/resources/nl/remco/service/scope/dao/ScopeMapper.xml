<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE mapper PUBLIC '-//mybatis.org//DTD Mapper 3.0//EN'
  'http://mybatis.org/dtd/mybatis-3-mapper.dtd'>

<mapper namespace='nl.remco.service.scope.dao.ScopeMapper'>
	<select id='getScopes' resultMap='scopeResult'>
		SELECT
		sco.*
		FROM scopes sco
		<where>
			<if test="ids!=null">
				sco.id IN
				<foreach item="id" collection="ids" open="(" separator=","
					close=")">
					#{id}
				</foreach>
			</if>
			<if test=" filter != null">
				<if test="filter.naam!=null">
					AND sco.naam like #{filter.naam}
				</if>
				<choose>
					<when test="filter.status!=null">
						AND sco.status = #{filter.status}
					</when>
					<otherwise>
						AND sco.status &lt;&gt; 'V'
					</otherwise>
				</choose>
			</if>
		</where>
	</select>

	<resultMap type='nl.remco.service.scope.model.Scope'
		id='scopeResult'>
		<id property='id' column='id' />
		<result property='laatstgewijzigd' column='laatstgewijzigd' />
		<result property='status' column='status' />
		<result property='naam' column='naam' />

		<association property="aangemaaktDoor" javaType="Identifiable">
			<id property="id" column="aangemaakt_door" />
		</association>

	</resultMap>

	<insert id='insertScope' parameterType='nl.remco.service.scope.model.Scope'
		useGeneratedKeys='true' keyProperty="id">
		INSERT INTO scopes
		(status, naam, aangemaakt_door)
		VALUES
		(#{status}, #{naam},
		#{aangemaaktDoor.id})
	</insert>


	<update id='updateScope' parameterType='nl.remco.service.scope.model.Scope'>
		UPDATE scopes sco
		<set>
			<if test="naam!= null">sco.naam= #{naam},</if>
			<if test="status != null">sco.status= #{status}</if>
		</set>
		WHERE sco.id = #{id} AND laatstgewijzigd=#{laatstgewijzigd}
	</update>

	<delete id='deleteScope' parameterType='Identifiable'>
		DELETE FROM scopes
		WHERE id=#{id} AND laatstgewijzigd=#{laatstgewijzigd}
	</delete>


</mapper>